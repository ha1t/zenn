---
title: "KeyBall44 組み立てトラブルシューティング"
emoji: "⛳"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: ["自作キーボード", "KeyBall", "KeyBall44"]
published: true
---

![](/images/20231029_keyball44_IMG_20231028_223841.webp)


自作キーボードに関してはCorne Cherryと Corne Cherry v3の2台を組んだ経験があるので、なんとかなるはず。と思って購入したKeyBall44ですが、
どれだけがんばってもトラックボールが反応しない。

以下は、トラックボールを動かすために GitHubのDiscussionを眺めて、書かれていた対処法をまとめたものです。自分はこれを全部やってもだめでした。が、バラしたり組み立てたりしているうちにトラックボールに関してはあっさり動くようになりました。
その後は今まで動いていたはずのTRRS接続がうまくいかないという問題がでましたが、はんだチェックで修正対応でき、無事に使えるようになりました。

困ったりうまくいかない時は https://github.com/Yowkees/keyball/discussions を見ましょう。Discussionsに質問するのはすべての過去の質問を見てからにしましょう。

:::message

~~この記事は、トラックボールが反応するようになるまで更新し続けます。~~
~~この記事は、KeyBall44がちゃんと使えるようになるまで更新し続けます。~~
無事に動作したので一旦更新終了とします。

:::

# 特定のキーが反応しない、反応が悪い
組み立て時に最も起こるトラブルがこれ。完成後の継続利用や、持ち運びなどでも発生します。原因ははんだ付けがうまくいってないかダイオードが死んだかです。テスターをあてながらチェックしていけば直せます

## はんだ付けがちゃんとできているか(テンプラ)がないかチェックする

まずはPCBのパッドと部品の間にはんだがちゃんと染み込んでいるかよく見てチェックしてください。はみ出すほど大きな玉になってるようだと怪しいです。

マクロ機能のあるカメラを使うと確認しやすいです。

![](/images/20231029_usemacro.webp)
*左のはんだ、ボソボソしているのも怪しい*

## COLとROWの導通チェック
キーがProMicroまでちゃんとつながっているのかを確認します。対象となるスイッチの赤、青の部分が繋がっているか確認してください。
ProMicroの刺さりが悪いと、1行まるごと、または1列まるごとキーが効かないとかになります。

![](/images/20231029_rowcolcheck.webp)

## 反応しないキーに対応するダイオードを見つける

キーはダイオードを通っているので、そのキーがどのダイオードに対応しているかを探します。以下の画像を参考にキーと周囲にあるダイオードをあてて抵抗が0Ωになるものを見つけてください。
テスターの設定で0Ωの時に音がなるようにしてあるとよいです。

![](/images/20231029_pickdiode.webp)

## ダイオードの生存チェック

動かないキーに対応するダイオードを見つけたら入念にテンプラチェックなどをするわけですが、
ダイオードは熱を加え続けると壊れてしまうので、テスターのダイオードチェック機能を使って壊れていないか調べましょう。怪しかったら交換してしまうと良いです。

![](/images/20231029_checkdiode.webp)


# トラックボールが反応しない時の対処法

・トラックボールは PWM3360 という基板で動いていて、おそらくSPI通信している。ので、ちょっとでも接触不良だと動かないはず。
・動いているかどうかの確認はもしかするとRESETスイッチじゃなくて電源抜き差しじゃないとだめかもしれない。

## うっかりミスチェック

以下が最初に確認すべきポイント

>うっかりミスとしてありがちなのが、下記ですので順番にご確認ください。
>１．光学センサーICの保護シール２枚のはがし忘れ
>２．光学センサーICの方向が逆
>３．光学センサーICやProMicroの挿入位置がひとつズレている
>４．ICやProMicroのはんだ付け不良
>５．ジャンパ８か所のはんだ不良（見た目では問題なくてもテンプラ不良している可能性があるので、もう一度、熱したはんだごてを当ててみて確認

また、

> 正常に動作していてもセンサーICのレンズ部は肉眼では光って見えません

ということなので、ボールが正常に動作しているか確認するのは結構難しい…

https://github.com/Yowkees/keyball/discussions/51

## コンスルーの曲がりチェック

> L字7Pコンスルーのピンの変形をご確認ください。少々の変形でも導通不良となる場合があります。

リンク先の画像を見てもらうとわかるようにちょっと曲がっていても駄目だったりする模様

https://github.com/Yowkees/keyball/discussions/388

## コンスルーが導通していない説

ProMicroのポートとコンスルーの導通を確認して、これが通ってない場合はNG。

ProMicroとコンスルーの

・SCL
・MOSI
・NCS
・MISO

をテスターで導通チェックする。0Ωじゃない場合はコンスルーかProMicroに問題がある。

自分はついでにトラックボール基板を外してUSBつないでコンスルーセンターの5Vと両サイドのGNDの電圧を測ってつながっているか確認した。（自分のは4.5Vくらいだった）

https://github.com/Yowkees/keyball/discussions/276

## ProMicroの導通問題(ピンずれ・半田不良)

ProMicroを入れ替えたら直るケース、原因がピンずれによる特定ピンの接触不良だった。

https://github.com/Yowkees/keyball/discussions/274#discussion-5400367

ProMicroの半田不良も同じ事になるようだが、自分は3個くらい交換して全部同じだったので関係ないかも

https://github.com/Yowkees/keyball/discussions/254

## トラックボール基板のはんだ不良

トラックボール基板にPWM3360をつけるときのはんだに不良がある可能性があります。レンズを外してはんだづけがちゃんとできているか確認してみるといいかもしれません。

ただしここは熱に弱そうなので、はんだをモリモリにする事を意識しすぎると壊れる可能性があります。

## センサーぶっこわれ説

手をつくしてもだめな場合はセンサーがぶっこわれているパターンもあるらしい。(自分の場合はボトムプレートをつけたり外したりしていると一瞬だけ反応する事があったのでまだ壊れていないと信じたい…。)
ProMicroみたいにもう一個あったら差し替えて原因の絞り込みができるのになぁ…。

https://github.com/Yowkees/keyball/discussions/388

## PCBにパターンの剥がれがないか

自分の基板を見ていて気がついたが、PCBのパターンが剥がれてしまっている事が原因の可能性がある。

![](/images/20231029_183447.webp)

上記の画像の場合、TRRSジャック周辺の3箇所にパターンの剥がれらしきものが見える。左の２つはGNDっぽいのでおそらく問題はないが、
右側のパターンが導通していない場合、左手親指の一番外側が動かない。
が、普通に動くんですよねー。

よくわからないですが、徹底的に確認したのにうまく動かない場合、見えないところでパターンが切れてしまっている可能性がありそうです。

# できるだけバラして組み立て直す
はんだづけ以外の部分を全部バラして組み立て直す。キートップをすべてはずして、ミドルプレート、ボトムプレートを外したあと、ミドルプレートがきつきつなのでちょっとヤスってみたり、動作確認などして再び組み立てる。

これでなぜかトラックボールが反応するようになりました。

ただし今度はTRRSケーブルで接続したサブのほうが反応しなくなりました。

# TRRSケーブルを接続してもサブのほうが反応しない

反応しないと言ってもいくつかのパターンがあるようで
・サブのOLEDがついてる
・サブのOLEDつかない

自分はOLED自体ついてない。ということは来ていると思っていたVCCかGNDがきてないのかも。

## 導通確認
TRRSケーブルは4線で、VCC、GND、DATA、P1を伝達している。ので、テスターを使って、接続先のケーブルのさきっぽと、メインのProMicro、基板で導通がとれているかを確認する。

![](/images/20231029_trrs_circuit.webp)
*引用元: https://github.com/Yowkees/keyball/blob/main/keyball44/design_data/Circuit_of_Keyball44_Ballside_rev1.pdf*

## ケーブル接続して両方のProMicroのDATAがつながっているか確認する
ケーブルじゃなくて直接ProMicro同士で導通しているか確認する。

https://github.com/Yowkees/keyball/discussions/313

## ケーブルを交換する
ケーブル自体が対応していなかったり、くねくねすると切れたりする不安定なものだったりする可能性があるので、別のタイプのケーブルを用意して差し替えてみる

## サブのはんだ付けも確認する
自分の場合はこれでした。今まで問題なく使えていたけど、よく見たらTRRSジャックのVCCがはんだのノリが弱そうで、少し盛ってやったら動きました。

# ジャンパブリッジのはんだ付け方法

自分は特に苦労しなかったですが、以下のサイトを参考にすると良さそうです。動画つきで非常にわかりやすいです。

https://note.com/yinouet1001/n/nc129c6914702







---
title: "dietcakeをPHP8.4対応しました"
emoji: "✨"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['php', 'dietcake']
published: true
published_at: 2025-12-17 00:00
---

この記事は PHP Advent Calendar 2025 17日を担当しています。

https://qiita.com/advent-calendar/2025/php

# dietcakeをPHP8.4対応しました

つい先月の話です。Claude Code on the Web が実装されて、スマホから簡単にGitHub上のコードをAIに書かせることができるようになったのですが、
期間限定で $200 のクレジットがもらえたのでクレジットを使い切るまで試してみるかと思いGitHubのリポジトリを見ていたら、dietcakeの事を思い出したので、最新のPHPでも動くように変更してみました。

実際のPull Requestはこちら。

https://github.com/dietcake/dietcake/pull/38

# 何を変更したのか？

## \#\[AllowDynamicProperties] の追加

PHP 8.2以降、クラス内で宣言されていないプロパティに値を代入する動的プロパティの使用は非推奨となりました。
これを回避するには、動的プロパティを許可したいクラスに対して ` #[AllowDynamicProperties] `を追加する必要があります。
非推奨の警告は、将来的に（PHP 9.0で）ErrorException に変わるそうですが、明示的にアトリビュートを指定する形式であれば9.0以降もこれでいけるはずです。

個人的には動的プロパティみたいな緩さもPHPの特徴の一つかなと思うので、アトリビュートで逃げ道を用意してくれたのはありがたいなと思いました。

## PHPUnitのバージョンアップ

PHP本体のバージョンアップに対応する形でPHPUnitも修正しました。バージョンアップすると結構記法が変わる印象があったので、ユニットテスト全部捨てる覚悟だったんですが、 `expectException` の記法が変わったくらいでほぼそのままでいけました。

## PHP7.4未満のサポートを切った

もう少し下まで動きそうですが、EOLのバージョンをサポートする需要はあるだろうか？という事で、いったんPHP 7.4以上とさせていただきました。
私としては限界まで古いバージョンに対応したいんですが、バージョンの幅を広げるとPHPUnitや周辺ライブラリの制御が難しくなるんですよね。

7.4未満のPHPで動かしたい方は今までどおりv2をご利用ください。

## Travis ciから GitHub Actionsへ

このリポジトリでは Travis CIという仕組みを使っていたのですが、今は GitHub Actionsがあるので、そっちで同じような事をやることにしました。
7.4から8.4までの各PHPバージョンでユニットテストの動作確認をしています。

# AIの登場によって手軽に改修できる時代になった

今回の変更は指示だけ自分でやって、コード自体はほぼClaude Code on the Webが書きました。自分で同じ作業をしていたら30倍くらいの時間がかかっていたと思います。

変更点だけを見れば、最新のPHPを追いかけている人にとってはどうってことないものなんですが、自分がPHPをがっつり触っていたのは10年くらい前なので、まずアトリビュートが導入されていた事すら知らなかったんですよね。

自分だけでやる場合、こういった知識を１つずつ体系的にキャッチアップしていく必要があったと思うんですが、AIの活用でピンポイントに必要な情報だけを効率的に取得できました。

dietcakeのライセンスファイルの最終コミットが14年前でびっくりしましたが、最近触ってない古いプロジェクトをAIで復活させるの面白いので、皆さんもやってみてはいかがでしょうか。

# 余談:最近のソフトウェアの寿命について

ここからは独り言です。10年ぶりくらいにWebエンジニアっぽい仕事をしているのですが、
最近はPHP本体やフレームワークの寿命が短すぎるように感じます。
とあるフレームワークはLTS以外は約半年でサポートが終わるとか。

ソフトウェア開発はよく建築に例えて話される事が多くて、アーキテクトなんかは建築由来のワードだったような気がしますが、
現代では半年毎に後方互換性を失う変更に追従しないといけなかったり、言語仕様の追加変更に対応する必要があって放置するとすぐにレガシーになってしまう状況があり、
そんな状況をみると、「私達って何を作ってるんだっけ？50年-100年持つ家というよりは、2年くらい使ったら買い替えるスマホみたいなものを作ってるんじゃないか？」と思います。

それでいいんだっけ?

たしかにスタートアップがPMF目指して高速開発したり、大量のアクセスに耐えられる設計や、運用後もユーザーのために大胆な変更やモダンな技術や機能の追加をし続けるニーズは増え続けています。
一方で、一度作りきったらそんなに変更せず、安く長く安定した運用ができればよい。見た目の変更を頻繁にやるとユーザーがついてこれないからあんまり変えなくていい。などのニーズは今もあるはずで、最近のモダンな言語、フレームワーク、ライブラリ、インフラなどはそういったニーズにたいしてあまり真摯に向き合ってくれていない印象があります。

皆さんはどう思いますか？

